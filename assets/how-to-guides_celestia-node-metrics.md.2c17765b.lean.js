import{_ as n,o as a,c as o,O as l}from"./chunks/framework.6b456e69.js";const d=JSON.parse('{"title":"celestia-node metrics","description":"A guide on how to run metrics for your celestia-node DA instance.","frontmatter":{"description":"A guide on how to run metrics for your celestia-node DA instance.","head":[["meta",{"property":"og:title","content":"celestia-node metrics | Celestia Docs"}],["meta",{"property":"og:description","content":"A guide on how to run metrics for your celestia-node DA instance."}]]},"headers":[],"relativePath":"how-to-guides/celestia-node-metrics.md","filePath":"how-to-guides/celestia-node-metrics.md","lastUpdated":1752877557000}'),p={name:"how-to-guides/celestia-node-metrics.md"};function e(t,s,c,r,y,E){return a(),o("div",null,s[0]||(s[0]=[l(`<h1 id="celestia-node-metrics" tabindex="-1">celestia-node metrics <a class="header-anchor" href="#celestia-node-metrics" aria-label="Permalink to &quot;celestia-node metrics&quot;">​</a></h1><p>This tutorial is for running metrics for your celestia-node data availability instance. This tutorial will focus on running metrics for a light node.</p><p>This tutorial assumes you have already setup your light node by following the tutorial in the <a href="/tutorials/node-tutorial">celestia-node API tutorial</a>.</p><h2 id="running-metrics-flags" tabindex="-1">Running metrics flags <a class="header-anchor" href="#running-metrics-flags" aria-label="Permalink to &quot;Running metrics flags&quot;">​</a></h2><p>You can enable the <code>celestia-node</code> metric flags with the following command:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">celestia</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">node-typ</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">start</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--metrics.tls=</span><span style="color:#F97583;">&lt;</span><span style="color:#79B8FF;">boolean</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">--metrics</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--metrics.endpoint</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">UR</span><span style="color:#E1E4E8;">I</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">--p2p.network</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">networ</span><span style="color:#E1E4E8;">k</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">--core.ip</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">UR</span><span style="color:#E1E4E8;">I</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--core.port</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">por</span><span style="color:#E1E4E8;">t</span><span style="color:#F97583;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">celestia</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">node-typ</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">start</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--metrics.tls=</span><span style="color:#D73A49;">&lt;</span><span style="color:#005CC5;">boolean</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">--metrics</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--metrics.endpoint</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">UR</span><span style="color:#24292E;">I</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">--p2p.network</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">networ</span><span style="color:#24292E;">k</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">--core.ip</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">UR</span><span style="color:#24292E;">I</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--core.port</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">por</span><span style="color:#24292E;">t</span><span style="color:#D73A49;">&gt;</span></span></code></pre></div><p>Add metrics flags to your node start command and restart your node to apply it. The metrics endpoint will gather your node&#39;s data to track your uptime.</p><p>Note that the <code>--metrics</code> flag enables metrics and expects an input into <code>--metrics.endpoint</code>.</p><p>We will go over what the endpoint will need to be in the <a href="#metrics-endpoint-design-considerations">metrics endpoint design considerations</a> section.</p><h3 id="mainnet-beta" tabindex="-1">Mainnet Beta <a class="header-anchor" href="#mainnet-beta" aria-label="Permalink to &quot;Mainnet Beta&quot;">​</a></h3><p>Here is an example for Mainnet Beta:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">celestia</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">node-typ</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">start</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--metrics.tls=true</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">--metrics</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--metrics.endpoint</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">otel.celestia.observer</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">--core.ip</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">UR</span><span style="color:#E1E4E8;">I</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--core.port</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">por</span><span style="color:#E1E4E8;">t</span><span style="color:#F97583;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">celestia</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">node-typ</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">start</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--metrics.tls=true</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">--metrics</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--metrics.endpoint</span><span style="color:#24292E;"> </span><span style="color:#032F62;">otel.celestia.observer</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">--core.ip</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">UR</span><span style="color:#24292E;">I</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--core.port</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">por</span><span style="color:#24292E;">t</span><span style="color:#D73A49;">&gt;</span></span></code></pre></div><h3 id="mocha-testnet" tabindex="-1">Mocha testnet <a class="header-anchor" href="#mocha-testnet" aria-label="Permalink to &quot;Mocha testnet&quot;">​</a></h3><p>Here is an example for Mocha testnet:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">celestia</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">node-typ</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">start</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--metrics.tls=true</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">--metrics</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--metrics.endpoint</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">otel.mocha.celestia.observer</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">--core.ip</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">UR</span><span style="color:#E1E4E8;">I</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--core.port</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">por</span><span style="color:#E1E4E8;">t</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--p2p.network</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">mocha</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">celestia</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">node-typ</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">start</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--metrics.tls=true</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">--metrics</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--metrics.endpoint</span><span style="color:#24292E;"> </span><span style="color:#032F62;">otel.mocha.celestia.observer</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">--core.ip</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">UR</span><span style="color:#24292E;">I</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--core.port</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">por</span><span style="color:#24292E;">t</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--p2p.network</span><span style="color:#24292E;"> </span><span style="color:#032F62;">mocha</span></span></code></pre></div><h3 id="arabica-devnet" tabindex="-1">Arabica devnet <a class="header-anchor" href="#arabica-devnet" aria-label="Permalink to &quot;Arabica devnet&quot;">​</a></h3><p>Here is an example for Arabica devnet:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">celestia</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">node-typ</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">start</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--metrics.tls=true</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">--metrics</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--metrics.endpoint</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">otel.arabica.celestia.observer</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">--core.ip</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">UR</span><span style="color:#E1E4E8;">I</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--core.port</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">por</span><span style="color:#E1E4E8;">t</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--p2p.network</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">arabica</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">celestia</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">node-typ</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">start</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--metrics.tls=true</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">--metrics</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--metrics.endpoint</span><span style="color:#24292E;"> </span><span style="color:#032F62;">otel.arabica.celestia.observer</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">--core.ip</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">UR</span><span style="color:#24292E;">I</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--core.port</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">por</span><span style="color:#24292E;">t</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--p2p.network</span><span style="color:#24292E;"> </span><span style="color:#032F62;">arabica</span></span></code></pre></div><h3 id="tls-connections" tabindex="-1">TLS connections <a class="header-anchor" href="#tls-connections" aria-label="Permalink to &quot;TLS connections&quot;">​</a></h3><p>The <code>--metrics.tls</code> flag enables or disables a TLS connection to the OpenTelemetry Protocol metrics backend. You need to choose a boolean value (<code>true</code> or <code>false</code>) for this flag.</p><p>It&#39;s also common to set this flag to <code>false</code> when spinning up a local collector to check the metrics locally.</p><p>However, if the collector is hosted in the cloud as a separate entity (like in a DevOps environment), enabling TLS is a necessity for secure communication.</p><p>Here are examples of how to use it:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># To enable TLS connection</span></span>
<span class="line"><span style="color:#B392F0;">celestia</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">node-typ</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">start</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--metrics.tls=true</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--metrics</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">--metrics.endpoint</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">UR</span><span style="color:#E1E4E8;">I</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">--p2p.network</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">networ</span><span style="color:#E1E4E8;">k</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--core.ip</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">UR</span><span style="color:#E1E4E8;">I</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--core.port</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">por</span><span style="color:#E1E4E8;">t</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># To disable TLS connection</span></span>
<span class="line"><span style="color:#B392F0;">celestia</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">node-typ</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">start</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--metrics.tls=false</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--metrics</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">--metrics.endpoint</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">UR</span><span style="color:#E1E4E8;">I</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">--p2p.network</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">networ</span><span style="color:#E1E4E8;">k</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--core.ip</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">UR</span><span style="color:#E1E4E8;">I</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--core.port</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">por</span><span style="color:#E1E4E8;">t</span><span style="color:#F97583;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># To enable TLS connection</span></span>
<span class="line"><span style="color:#6F42C1;">celestia</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">node-typ</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">start</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--metrics.tls=true</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--metrics</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">--metrics.endpoint</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">UR</span><span style="color:#24292E;">I</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">--p2p.network</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">networ</span><span style="color:#24292E;">k</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--core.ip</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">UR</span><span style="color:#24292E;">I</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--core.port</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">por</span><span style="color:#24292E;">t</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># To disable TLS connection</span></span>
<span class="line"><span style="color:#6F42C1;">celestia</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">node-typ</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">start</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--metrics.tls=false</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--metrics</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">--metrics.endpoint</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">UR</span><span style="color:#24292E;">I</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">--p2p.network</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">networ</span><span style="color:#24292E;">k</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--core.ip</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">UR</span><span style="color:#24292E;">I</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--core.port</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">por</span><span style="color:#24292E;">t</span><span style="color:#D73A49;">&gt;</span></span></code></pre></div><h2 id="metrics-endpoint-design-considerations" tabindex="-1">Metrics endpoint design considerations <a class="header-anchor" href="#metrics-endpoint-design-considerations" aria-label="Permalink to &quot;Metrics endpoint design considerations&quot;">​</a></h2><p>At the moment, the architecture of celestia-node metrics works as specified in the following <a href="https://github.com/celestiaorg/celestia-node/blob/main/docs/adr/adr-010-incentivized-testnet-monitoring.md" target="_blank" rel="noreferrer">ADR #010</a>.</p><p>Essentially, the design considerations here will necessitate running an OpenTelemetry (OTEL) collector that connects to Celestia light node.</p><p>For an overview of OTEL, check out <a href="https://opentelemetry.io/docs/collector" target="_blank" rel="noreferrer">the guide</a>.</p><p>The ADR and the OTEL docs will help you run your collector on the metrics endpoint. This will then allow you to process the data in the collector on a Prometheus server which can then be viewed on a Grafana dashboard.</p><p>In the future, we do want to open-source some developer toolings around this infrastructure to allow for node operators to be able to monitor their data availability nodes.</p><h3 id="configure-celestia-node-to-export-to-multiple-otel-collectors" tabindex="-1">Configure celestia-node to export to multiple OTEL collectors <a class="header-anchor" href="#configure-celestia-node-to-export-to-multiple-otel-collectors" aria-label="Permalink to &quot;Configure celestia-node to export to multiple OTEL collectors&quot;">​</a></h3><p>It is not supported to directly export metrics to multiple OTEL collectors (see the discussions <a href="https://github.com/open-telemetry/opentelemetry-go/issues/3055" target="_blank" rel="noreferrer">here</a>). To achieve this goal, an agent OTEL collector needs to be deployed for the node, from which the metrics can be forwarded to any other OTEL collectors. Here are the necessary steps and example configurations.</p><p>Follow the instructions <a href="https://opentelemetry.io/docs/collector/installation/" target="_blank" rel="noreferrer">here</a> to install the OTEL collector. If you have the binary installed in <code>/usr/local/bin/otelcol</code>, you may consider creating a systemd service to run the collector as a background service. Here is an example of a systemd service definition in <code>/etc/systemd/system/otelcol.service</code>:</p><div class="language-ini vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">[Unit]</span></span>
<span class="line"><span style="color:#F97583;">Description</span><span style="color:#E1E4E8;">=OpenTelemetry Collector</span></span>
<span class="line"><span style="color:#F97583;">After</span><span style="color:#E1E4E8;">=network.target</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">[Service]</span></span>
<span class="line"><span style="color:#F97583;">ExecStart</span><span style="color:#E1E4E8;">=/usr/local/bin/otelcol --config /path/to/otelcol_config.yaml</span></span>
<span class="line"><span style="color:#F97583;">Restart</span><span style="color:#E1E4E8;">=on-failure</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">[Install]</span></span>
<span class="line"><span style="color:#F97583;">WantedBy</span><span style="color:#E1E4E8;">=multi-user.target</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">[Unit]</span></span>
<span class="line"><span style="color:#D73A49;">Description</span><span style="color:#24292E;">=OpenTelemetry Collector</span></span>
<span class="line"><span style="color:#D73A49;">After</span><span style="color:#24292E;">=network.target</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">[Service]</span></span>
<span class="line"><span style="color:#D73A49;">ExecStart</span><span style="color:#24292E;">=/usr/local/bin/otelcol --config /path/to/otelcol_config.yaml</span></span>
<span class="line"><span style="color:#D73A49;">Restart</span><span style="color:#24292E;">=on-failure</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">[Install]</span></span>
<span class="line"><span style="color:#D73A49;">WantedBy</span><span style="color:#24292E;">=multi-user.target</span></span></code></pre></div><p>The following is an example of the <code>otelcol_config.yaml</code> file that transforms the metrics into Prometheus metrics and reports them to the Celestia OTEL collector at the same time:</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">receivers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">otlp</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">protocols</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">http</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># Enable HTTP receiving</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">endpoint</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;127.0.0.1:4318&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># the endpoint where the celestia-node will send metrics (the default value of --metrics.endpoint for celestia when --metrics is specified)</span></span>
<span class="line"><span style="color:#85E89D;">exporters</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">prometheus</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># the node metrics will be transformed to Prometheus format and exposed on the following endpoint</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">endpoint</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;0.0.0.0:8889&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;celestia&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">otlphttp</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># report the metrics to Mocha testnet OTEL collector as an example</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># change it according to your network</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">endpoint</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">https://otel.mocha.celestia.observer</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D;">service</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">pipelines</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">metrics</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">receivers</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">otlp</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">exporters</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">prometheus</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">otlphttp</span><span style="color:#E1E4E8;">]</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">receivers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">otlp</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">protocols</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">http</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># Enable HTTP receiving</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">endpoint</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;127.0.0.1:4318&quot;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># the endpoint where the celestia-node will send metrics (the default value of --metrics.endpoint for celestia when --metrics is specified)</span></span>
<span class="line"><span style="color:#22863A;">exporters</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">prometheus</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># the node metrics will be transformed to Prometheus format and exposed on the following endpoint</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">endpoint</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;0.0.0.0:8889&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;celestia&quot;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">otlphttp</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># report the metrics to Mocha testnet OTEL collector as an example</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># change it according to your network</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">endpoint</span><span style="color:#24292E;">: </span><span style="color:#032F62;">https://otel.mocha.celestia.observer</span></span>
<span class="line"></span>
<span class="line"><span style="color:#22863A;">service</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">pipelines</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">metrics</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">receivers</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">otlp</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">exporters</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">prometheus</span><span style="color:#24292E;">, </span><span style="color:#032F62;">otlphttp</span><span style="color:#24292E;">]</span></span></code></pre></div><p>Run the following commands to enable the OTEL collector systemd service:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">systemctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">daemon-reload</span></span>
<span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">systemctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">enable</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--now</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">otelcol.service</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># check the status of the service</span></span>
<span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">systemctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">status</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">otelcol.service</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">systemctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">daemon-reload</span></span>
<span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">systemctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">enable</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--now</span><span style="color:#24292E;"> </span><span style="color:#032F62;">otelcol.service</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># check the status of the service</span></span>
<span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">systemctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">status</span><span style="color:#24292E;"> </span><span style="color:#032F62;">otelcol.service</span></span></code></pre></div><p>If the collector is up and running without any error, you can adjust the options for the <code>celestia-node</code> service:</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">celestia</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">node-typ</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">start</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--metrics.tls=false</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">--metrics</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--metrics.endpoint</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">localhost:4318</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">...</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">celestia</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">node-typ</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">start</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--metrics.tls=false</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">--metrics</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--metrics.endpoint</span><span style="color:#24292E;"> </span><span style="color:#032F62;">localhost:4318</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">...</span></span></code></pre></div>`,40)]))}const F=n(p,[["render",e]]);export{d as __pageData,F as default};
